<!DOCTYPE html>
<html>
	<head>
		<title>Archive of All Mod Cons</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

		<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
		<!--<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>-->

		<link href="mediaelement/mediaelementplayer.css" rel="stylesheet">
		<script src="mediaelement/mediaelement-and-player.js"></script>

		<!--<link href="http://mottie.github.io/tablesorter/css/theme.bootstrap.css" rel="stylesheet">-->
		<script src="http://mottie.github.io/tablesorter/js/jquery.tablesorter.js"></script>
		<!--<script src="http://mottie.github.io/tablesorter/js/jquery.tablesorter.widgets.js"></script>-->
		<style>
			span.player {
				margin: 5px 0;
				float:  right;
			}
			table {
				margin:    10px auto 0 auto;
				max-width: 800px;
			}
			tr {
				cursor: pointer;
			}
			span.mejs-time-float {
				top:         -15px !important;
				margin-left: -24px !important;
			}
		</style>

		<script type="text/javascript">
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-40720743-1', 'swook.net');
			ga('send', 'pageview');
		</script>
	</head>
	<body>
		<div class="navbar navbar-inverse navbar-static-top">
			<div class="navbar-inner">
				<a class="brand" href="/">All Mod Cons <small>an archive</small></a>
				<span class="player"><audio preload="false"/></span>
			</div>
		</div>
		<div class="container-fluid">
			<table class="table table-hover tablesorter">
				<thead>
					<tr>
						<th>Date</th>
						<th>Location</th>
						<th>Download</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<script type="text/javascript">
		$(document).ready(function() {
			$.getJSON('shows.json', function(shows) {
				var table = $('table');

				// Add shows to table
				$.each(shows, function (i, e) {
					st = 0;
					if (e[3].length) {
						a  = e[3].split(':');
						st = parseInt(a[0]) * 60 + parseInt(a[1]);
					}
					table.append('<tr>'+
						'<td title="'+e[2].split(" ")[0]+'">'+e[0]+'</td>'+
						'<td>'+(e.length >= 2 ? e[1] : '')+'</td>'+
						'<td>'+(e.length >= 3 ? '<a class="download" href="'+e[2]+'" starttime="'+st+'"><i class="icon-download"></i> MP3</a>' : '')+'</td>');
				});

				table.tablesorter({
					textExtraction : function(node) {
						var $node = $(node),
							title = $node.attr('title');
						if (title > "") return title;
						return $node.html();
					},
				});

				// Setup MediaElementPlayer
				var audio  = $('audio'),
				    tracks = $('tr'),
				    first   = $('a.download', tracks[1]);
				audio.attr('src', first.attr('href'));
				window.player = new MediaElementPlayer('audio', {
					audioWidth:     500,
					success:        function(m) {
						setTimeout(function() {
							m.play();
							m.setCurrentTime(first.attr('starttime'));
						}, 100);
					}
				});
				tracks.click(function(e) {
					var lnk = $('a.download', this),
					    url = lnk.attr('href'),
					    st  = lnk.attr('starttime');
					if (!url) return;
					window.player.pause();
					if (url != window.player.media.src) window.player.setSrc(url);
					window.player.pause();
					if (st > 0) {
						setTimeout(function() {
							window.player.play();
							window.player.setCurrentTime(st);
						}, 100);
					} else window.player.play();
				});
			});
		});
		</script>
	</body>
</html>
